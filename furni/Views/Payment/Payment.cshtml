@model List<ProductItem>
@using furni.Data
@using furni.Models
@using Microsoft.AspNetCore.Identity

@inject UserManager<ApplicationUser> UserManager
@{
    Layout = null;
    var index = 0;
    var user = await UserManager.GetUserAsync(User);
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>@Localizer["Sản phẩm"]</title>
    <link rel="icon" href="img/favicon.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Sora:wght@100..800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Nunito:ital,wght@0,200..1000;1,200..1000&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Sora:wght@100..800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/payment.css">
    <title>Document</title>
</head>
<body>
    <div class="payment">
        <div class="contai container d-flex justify-content-between">
            <div class="logo d-flex align-items-center">
                <h1 style="margin: 0px;">@Html.ActionLink("Furni", "Index", "Home")</h1>
                <p style="margin: 0px;">@Localizer["Thanh toán"]</p>
            </div>
            <div class="mess d-flex align-items-center">
                <i class="fa-solid fa-phone"></i>
                <div class="phone">
                    <p>1900-1099</p>
                    <p>8h - 21h, cả T7&CN</p>
                </div>
            </div>
        </div>

    </div>
    <div class="contai container d-flex justify-content-between main">
        <div class="content-right col-9">
            <h2 style="padding-left: 25px;">@Localizer["Chọn hình thức giao hàng"]</h2>
            <div class="transformer">
                <div class="form-check">
                    <label class="radio expensive" for="trans--check">
                        <input type="radio" name="giao-hang-method" id="trans--check" checked>
                        @Localizer["Giao hàng hoả tốc"] <span>50k</span>
                    </label>
                </div>
            </div>
            <div class="list-product" style="margin-left: 20px;">
                <div class="head-time d-flex align-items-baseline">
                    <i class="fa-solid fa-box" style="margin-right: 10px;"></i>
                    <p>@Localizer["Gói: Giao đúng ngày mai"], 10h - 16h, @DateTime.Now.AddDays(1).ToString("dd/MM")</p>
                </div>
                <p>@Localizer["Giao hàng tiết kiệm"]</p>

                @foreach (var item in Model)
                {
                    <div class="d-flex align-items-center" style="width: 60%">
                        <div class="col-3">
                            <figure>
                                <img class="image-product" src="@item.ImageUrl" alt="">
                            </figure>
                        </div>
                        <div class="col-9" style="margin-left: -10px;">
                            <p style="margin-bottom: 5px; color: #808089;">@item.Name</p>
                            <div class="d-flex justify-content-between">
                                <p style="color: #808089;">SL: x @item.Quantity</p>
                                <p class="total-price">@item.TotalPrice</p>
                            </div>
                        </div>
                    </div>
                    index++;
                }

            </div>
            <div class="hr-th">
            </div>
            <div class="thanh-toan">
                <p style="margin-top: 20px; font-size: 18px; font-weight: 600; color: #38383d;">@Localizer["Chọn hình thức thanh toán"]</p>
                <div class="list-thanh-toan">
                    <label class="method-pay" for="payment-1" style="display: block;">
                        <input type="radio" name="method" id="payment-1" value="Tien Mat" checked>
                        <span style="margin-right: 10px; background-color: transparent;">
                            <img src="https://salt.tikicdn.com/ts/upload/92/b2/78/1b3b9cda5208b323eb9ec56b84c7eb87.png" width="32px" height="32px" alt="" ">
                        </span>
                        @Localizer["Thanh toán tiền mặt khi nhận hàng"]
                    </label>
                    <label class="method-pay" for="payment-2" style="display: block; margin-top: 40px;">
                        <input type="radio" name="method" id="payment-2" value="VN Pay">
                        <span style="margin-right: 10px; background-color: transparent;">
                            <img src="https://salt.tikicdn.com/ts/upload/77/6a/df/a35cb9c62b9215dbc6d334a77cda4327.png" width="32px" height="32px" alt="">
                        </span>
                        @Localizer["Thanh toán bằng VNPAY"]
                    </label>
                    <label class="method-pay" for="payment-3" style="display: block; margin-top: 40px;">
                        <input type="radio" name="method" id="payment-3" value="VN Pay">
                        <span style="margin-right: 10px; background-color: transparent;">
                            <img src="https://salt.tikicdn.com/ts/upload/ce/f6/e8/ea880ef285856f744e3ffb5d282d4b2d.jpg" width="32px" height="32px" alt="">
                        </span>
                        @Localizer["Thanh toán bằng ví MoMo"]
                    </label>
                    <label class="method-pay" for="payment-4" style="display: block; margin-top: 40px; margin-bottom: 20px">
                        <input type="radio" name="method" id="payment-4">
                        <span style="margin-right: 10px; background-color: transparent;">
                            <img src="https://salt.tikicdn.com/ts/upload/2f/43/da/dd7ded6d3659036f15f95fe81ac76d93.png" width="32px" height="32px" alt="">
                        </span>
                        @Localizer["Ví ZaloPay"]
                    </label>
                </div>
            </div>
        </div>
        <div class="col-3 content-left">
            <div class="head-left">
                <di class="d-flex justify-content-between align-items-baseline">
                    <p style="margin-top: 15px; font-size: 19px; color: #808089;">@Localizer["Giao tới"]</p>
                    <p style="margin-top: 15px; padding-right: 20px; font-size: 16px; color: #4d4dec;">@Localizer["Thay đổi"]</p>
                </di>
                <div class="address d-flex">
                    <p class="name infor">@(user.LastName + user.FirstName)</p>
                    <p class="infor">@user.PhoneNumber</p>
                </div>
                <p style="color: #808089;"><span style="padding: 4px 8px; background: #f1f4e3; margin-right: 4px;">@Localizer["Nhà"]</span>@user.Address</p>
            </div>
            <div class="coupon-left">
                <p style="font-weight: 500; margin-top: 10px;">@Localizer["Furni khuyến mãi"]</p>
                <div class="d-flex align-items-baseline" style="color: rgb(11, 116, 229);">
                    <i class="fa-solid fa-ticket" style="margin-right: 10px;"></i>
                    <p>@Localizer["Chọn hoặc nhập mã giảm giá"]</p>
                </div>
            </div>
            <div class="list-payment">
                <div class="d-flex justify-content-between align-items-baseline">
                    <p style="margin-top: 15px; font-size: 19px;">@Localizer["Đơn hàng"]</p>
                    <p style="margin-top: 15px; padding-right: 20px; font-size: 16px; color:rgb(11, 116, 229)"></p>
                </div>
                <div class="d-flex justify-content-between align-items-baseline">
                    <p style="margin-top: 15px; font-size: 19px;">@index @Localizer["Sản phẩm"]</p>
                    <a href="javascript:history.back()" class="more-info" style="margin-top: 15px; padding-right: 20px; font-size: 16px; color:rgb(11, 116, 229); text-decoration: none">@Localizer["Thông tin sản phẩm"]</a>
                </div>
            </div>
            <div class="sum-money">
                <div class="d-flex justify-content-between align-items-baseline">
                    <p>@Localizer["Tạm tính"]</p>
                    <p id="tam--tinh">0 đ</p>
                </div>
                <div class="d-flex justify-content-between align-items-baseline">
                    <p>@Localizer["Phí vận chuyển"]</p>
                    <p>50.000 đ</p>
                </div>
                <div class="d-flex justify-content-between align-items-baseline">
                    <p>@Localizer["Khuyến mãi vẫn chuyển"]</p>
                    <p style="color: #00ab56;">0 đ</p>
                </div>
                <div class="d-flex justify-content-between align-items-baseline" style="border-bottom: 1px solid rgb(235, 235, 240);">
                    <p>@Localizer["Giảm giá"]</p>
                    <p style="color: #00ab56;">0 đ</p>
                </div>
                <div class="d-flex justify-content-between align-items-baseline">
                    <p style="margin-top: 10px">@Localizer["Tổng tiền"]</p>
                    <p id="sum--tam__tinh" style="font-size: 25px; margin-top: 10px; color: rgb(255, 66, 78);">0 đ</p>
                </div>
                <div class="d-flex justify-content-center align-items-center btn-dat--hang" onclick="submitCheckout()">
                    @Localizer["Đặt hàng"]
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="contai container">
            <div class="footer-payment">
                <p style="margin-bottom: 5px;">@Localizer["Bằng việc tiến hành Đặt Mua, bạn đồng ý với các Điều kiện Giao dịch chung:"]</p>
                <div class="d-flex footer-list">
                    <p>@Localizer["Quy chế hoạt động"]</p>
                    <p>@Localizer["Chính sách giải quyết khiếu nại"]</p>
                    <p>@Localizer["Chính sách bảo hành"]</p>
                    <p>@Localizer["Chính sách bảo mật thanh toán"]</p>
                    <p>@Localizer["Chính sách bảo mật thông tin cá nhân"]</p>
                </div>
                <p style="color: #808089; font-size: 13px;">&copy; 2024 bản quyền của Nhóm 9 Lập trình Web (Nguyễn Mạnh Hùng)</p>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        window.onload = function () {
            var totalPriceElements = document.getElementsByClassName('total-price');
            var total = 0;

            for (var i = 0; i < totalPriceElements.length; i++) {
                // Loại bỏ các ký tự không phải số và chuyển đổi chuỗi thành số
                var priceText = totalPriceElements[i].innerText.replace(/[^\d]/g, '');
                var price = parseFloat(priceText);
                if (!isNaN(price)) {
                    total += price;
                }
            }
            var change = 50000;
            var sum = total + change;
            // Cập nhật tổng vào phần tử có ID 'tam--tinh'
            document.getElementById('tam--tinh').innerText = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(total);
            document.getElementById('sum--tam__tinh').innerText = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(sum);
        }
    </script>
    <script>
        function submitCheckout() {
            // Xác định phương thức thanh toán được chọn
            var selectedPaymentMethod = document.querySelector('input[name="method"]:checked').value;

            // Gửi dữ liệu đến server sử dụng AJAX
            fetch('/Payment/checkout', { // Thay 'ControllerName' bằng tên controller thực tế của bạn
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({ payment: selectedPaymentMethod })
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(data => {
                    if (data.redirectUrl) {
                        window.location.href = data.redirectUrl; // Chuyển hướng đến URL nhận được
                    } else {
                        alert(data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    </script>
</body>
</html>